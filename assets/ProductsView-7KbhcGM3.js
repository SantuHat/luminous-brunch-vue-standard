import{M as V,d as x,P as $}from"./PaginationView-i_hUGhVC.js";import{_ as g,o as u,c as m,b as t,q as a,v as r,y as k,e as E,r as h,d as _,F as P,g as I,t as b}from"./index-_e0xypRU.js";import"./component-functions-ejum1qjT.js";var U={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"luminous",BASE_URL:"/luminous-brunch-vue-standard/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:T,VITE_PATH:D}=U,A={props:{product:{type:Object,default(){return{}}}},watch:{product(){this.temProduct=this.product}},data(){return{temProduct:{},myModal:""}},methods:{showModal(){this.myModal.show()},hideModal(){this.myModal.hide()},uploadFile(){const l=this.$refs.fileInput.files[0],o=new FormData;o.append("file-to-upload",l);const d=`${T}api/${D}/admin/upload`;this.$http.post(d,o).then(n=>{console.log(n.data),n.data.success&&(this.temProduct.imageUrl=n.data.imageUrl)})}},mounted(){this.myModal=new V(this.$refs.productModal)}},C={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},L={class:"modal-dialog modal-xl"},F={class:"modal-content border-0"},S=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{id:"productModalLabel",class:"modal-title"},[t("span",null,"新增產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),R={class:"modal-body"},B={class:"row"},H={class:"col-sm-4"},O={class:"mb-2"},N={class:"mb-3"},j=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),q=["src"],z={class:"mb-3"},G=t("label",{for:"customFile",class:"form-label"},[E("或 上傳圖片 "),t("i",{class:"fas fa-spinner fa-spin"})],-1),J=t("div",null,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100"}," 新增圖片 ")],-1),K=t("div",null,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100 mt-2"}," 刪除圖片 ")],-1),Q={class:"col-sm-8"},W={class:"mb-3"},X=t("label",{for:"title",class:"form-label"},"標題",-1),Y={class:"row"},Z={class:"mb-3 col-md-6"},tt=t("label",{for:"category",class:"form-label"},"分類",-1),ot={class:"mb-3 col-md-6"},et=t("label",{for:"price",class:"form-label"},"單位",-1),st={class:"row"},lt={class:"mb-3 col-md-6"},dt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),nt={class:"mb-3 col-md-6"},it=t("label",{for:"price",class:"form-label"},"售價",-1),ct=t("hr",null,null,-1),at={class:"mb-3"},rt=t("label",{for:"description",class:"form-label"},"產品描述",-1),ut={class:"mb-3"},mt=t("label",{for:"content",class:"form-label"},"說明內容",-1),pt={class:"mb-3"},ht={class:"form-check"},_t=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),bt={class:"modal-footer"},ft=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Pt(l,o,d,n,e,i){return u(),m("div",C,[t("div",L,[t("div",F,[S,t("div",R,[t("div",B,[t("div",H,[t("div",O,[t("div",N,[j,a(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":o[0]||(o[0]=s=>e.temProduct.imageUrl=s)},null,512),[[r,e.temProduct.imageUrl]])]),t("img",{class:"img-fluid",src:e.temProduct.imageUrl,alt:""},null,8,q)]),t("div",z,[G,t("input",{type:"file",id:"customFile",class:"form-control",ref:"fileInput",onChange:o[1]||(o[1]=(...s)=>i.uploadFile&&i.uploadFile(...s))},null,544)]),J,K]),t("div",Q,[t("div",W,[X,a(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":o[2]||(o[2]=s=>e.temProduct.title=s)},null,512),[[r,e.temProduct.title]])]),t("div",Y,[t("div",Z,[tt,a(t("input",{id:"category",type:"text",class:"form-control","onUpdate:modelValue":o[3]||(o[3]=s=>e.temProduct.category=s),placeholder:"請輸入分類"},null,512),[[r,e.temProduct.category]])]),t("div",ot,[et,a(t("input",{id:"unit",type:"text",class:"form-control","onUpdate:modelValue":o[4]||(o[4]=s=>e.temProduct.unit=s),placeholder:"請輸入單位"},null,512),[[r,e.temProduct.unit]])])]),t("div",st,[t("div",lt,[dt,a(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control","onUpdate:modelValue":o[5]||(o[5]=s=>e.temProduct.origin_price=s),placeholder:"請輸入原價"},null,512),[[r,e.temProduct.origin_price,void 0,{number:!0}]])]),t("div",nt,[it,a(t("input",{id:"price",type:"number",min:"0",class:"form-control","onUpdate:modelValue":o[6]||(o[6]=s=>e.temProduct.price=s),placeholder:"請輸入售價"},null,512),[[r,e.temProduct.price,void 0,{number:!0}]])])]),ct,t("div",at,[rt,a(t("textarea",{id:"description",type:"text",class:"form-control","onUpdate:modelValue":o[7]||(o[7]=s=>e.temProduct.description=s),placeholder:"請輸入產品描述"},`\r
                `,512),[[r,e.temProduct.description]])]),t("div",ut,[mt,a(t("textarea",{id:"description",type:"text",class:"form-control","onUpdate:modelValue":o[8]||(o[8]=s=>e.temProduct.content=s),placeholder:"請輸入說明內容"},`\r
                `,512),[[r,e.temProduct.content]])]),t("div",pt,[t("div",ht,[a(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[9]||(o[9]=s=>e.temProduct.is_enabled=s)},null,512),[[k,e.temProduct.is_enabled]]),_t])])])])]),t("div",bt,[ft,t("button",{type:"button",class:"btn btn-primary",onClick:o[10]||(o[10]=s=>l.$emit("update-product",e.temProduct))}," 確認 ")])])])],512)}const gt=g(A,[["render",Pt]]);var vt={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"luminous",BASE_URL:"/luminous-brunch-vue-standard/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:p,VITE_PATH:f}=vt,Mt={data(){return{products:[],temProduct:{},pages:{},isNew:!1,isLoading:!1}},components:{ProductModal:gt,DelModal:x,PaginationView:$},inject:["emitter"],methods:{getProducts(l=1){const o=`${p}api/${f}/admin/products?page=${l}`;this.isLoading=!0,this.$http.get(o).then(d=>{this.isLoading=!1,this.products=d.data.products,this.pages=d.data.pagination,console.log(d)})},updateProduct(){const l=this.$refs.productModal;let o=`${p}api/${f}/admin/product`,d="post";this.isNew||(o=`${p}api/${f}/admin/product/${this.temProduct.id}`,d="put"),this.$http[d](o,{data:this.temProduct}).then(n=>{l.hideModal(),this.temProduct={},this.$httpMessageState(n,"更新"),this.getProducts()}).catch(n=>{alert(n.data.message)})},dleProduct(){const l=`${p}api/${f}/admin/product/${this.temProduct.id}`;this.$http.delete(l).then(()=>{this.getProducts(),this.$refs.delModal.hideModal()})},check(){const l=`${p}api/user/check`;this.$http.post(l).then(o=>{o.data.success||(window.location="login.html")}).catch(()=>{window.location="login.html"})},openModal(l,o){console.log(l,o),l?this.temProduct={}:this.temProduct={...o},this.isNew=l,this.$refs.productModal.showModal()},openDelModal(l){this.temProduct={...l},this.$refs.delModal.showModal()}},mounted(){const l=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=l,this.getProducts()}},yt={class:"container-fluid"},wt={class:"text-end me-3 mt-4"},Vt={class:"table mt-4"},xt=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",{width:"120"},"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"200"},"編輯")])],-1),$t={class:"text-right"},kt={class:"text-right"},Et={key:0,class:"text-success"},It={key:1,class:"text-muted"},Ut={class:"btn-group"},Tt=["onClick"],Dt=["onClick"];function At(l,o,d,n,e,i){const s=h("LoadingView"),v=h("ProductModal"),M=h("DelModal"),y=h("PaginationView");return u(),m(P,null,[_(s,{active:e.isLoading},null,8,["active"]),t("div",yt,[t("div",wt,[t("button",{class:"btn btn-primary",type:"button",onClick:o[0]||(o[0]=c=>i.openModal(!0))},"產品新增")]),t("table",Vt,[xt,t("tbody",null,[(u(!0),m(P,null,I(e.products,c=>(u(),m("tr",{key:c.id},[t("td",null,b(c.category),1),t("td",null,b(c.title),1),t("td",$t,b(c.origin_price),1),t("td",kt,b(c.price),1),t("td",null,[c.is_enabled?(u(),m("span",Et,"啟用")):(u(),m("span",It,"未啟用"))]),t("td",null,[t("div",Ut,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:w=>i.openModal(!1,c)},"編輯",8,Tt),t("button",{class:"btn btn-outline-danger btn-sm",onClick:w=>i.openDelModal(c)},"刪除",8,Dt)])])]))),128))])]),_(v,{ref:"productModal",product:e.temProduct,onUpdateProduct:i.updateProduct},null,8,["product","onUpdateProduct"]),_(M,{item:e.temProduct,ref:"delModal",onDelItem:i.dleProduct},null,8,["item","onDelItem"]),_(y,{pagination:e.pages,onEmitPages:i.getProducts},null,8,["pagination","onEmitPages"])])],64)}const St=g(Mt,[["render",At]]);export{St as default};
