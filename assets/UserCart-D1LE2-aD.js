import{_ as w,m as v,u as C,a as y,L as D,r as d,o,c as l,b as s,d as n,n as c,f as r,t as E,s as h,w as b,F as O,e as x}from"./index-CPGaNytM.js";import{o as g}from"./orderStore-BnDnnbyA.js";import{c as k}from"./cartStore-DJ1VhbNd.js";import{U as R}from"./UserCartEmptyData-DMUa-EOn.js";import{M as U}from"./MealList-DOKByAPx.js";var A={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"luminous",BASE_URL:"/luminous-brunch-vue-standard/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:M,VITE_PATH:j}=A,F={data(){return{totalPrice:0,step:1,userData:{data:{user:{name:"",email:"",tel:"",address:"高雄市"}}},orderId:"",obj:{choose:"請選擇"},orderTotal:0}},watch:{"obj.choose":function(){this.$refs.到店取餐付款?this.$refs.phone.innerHTML="":this.$refs.信用卡&&(this.$refs.phone.innerHTML="")}},methods:{...v(g,["getOrders","getOrderItem"]),...v(k,["getCarts","setIsLoading"]),scrollTo(){window.scrollTo(0,0)},nextStep(a){this.setIsLoading(!0),this.step=a,window.scrollTo(0,0),setTimeout(()=>{this.setIsLoading(!1)},500)},postOrder(){const a=`${M}/api/${j}/order`;C.post(a,this.userData).then(t=>{this.orderId=t.data.orderId,this.orderTotal=t.data.total,this.getCarts(),this.getOrderItem(this.orderId)}).catch(t=>{alert(t)})},handleOrderSubmit(){this.nextStep(3),this.postOrder()}},computed:{...y(g,["userOrders","orderItem","orderTotal"]),...y(k,["carts","final_total","isAreaLoading","isLoading"])},mounted(){this.getOrders(),this.getCarts()},components:{LoadingSpinner:D,UserCartEmptyData:R,MealList:U}},P={class:"container mb-11"},B={class:"step-indicator mx-auto mt-5"},q=s("div",{class:"step active",id:"step1"},[s("span",null,"確認訂單")],-1),H=s("div",{class:"line"},null,-1),N=s("span",null,"填寫資料",-1),z=[N],G=s("div",{class:"line"},null,-1),J=s("span",null,"完成訂單",-1),K=[J],Q={key:0,class:"frame"},W={key:0,class:"text-center mb-7 mt-5 orderResult fw-bold"},X={key:1,class:"text-center mb-7 orderResult fw-bold"},Y={key:2,class:"text-center mb-7 orderResult fw-normal"},Z={key:1,class:"mb-3 mt-3 text-center text-gray-400 orderResult"},$={key:2,class:"container mt-5 mb-9"},ee={key:3,class:"container mt-5 mb-9"},se={class:"area-loading"},te={key:0,class:"area-loading-wrap"},oe={key:0,class:"mb-5 mt-10 text-center text-gray-400 orderResult"},re={class:"col-md-4 mx-auto"},le=s("option",{value:"請選擇"},"請選擇",-1),ae={value:"到店取餐付款",ref:"到店取餐付款"},ne={value:"信用卡",ref:"信用卡"},ie={key:0,class:"mb-5 mt-10 text-center text-gray-400 orderResult"},de={class:"container"},ce={class:"row order-data d-flex align-items-center",style:{"flex-direction":"column"}},me={class:"col-md-4 mb-2"},pe=s("label",{for:"name",class:"sr-only text-primary py-3"},"姓名",-1),ue={class:"col-md-4 mb-2"},_e=s("label",{for:"orderTel",class:"sr-only text-primary py-3"},"電話",-1),he={class:"col-md-4 mb-4"},be=s("label",{for:"orderEmail",class:"sr-only text-primary py-3"},"信箱",-1),fe={key:0,class:"btn-box d-flex"},ve=s("button",{class:"btn_reserve py-3 px-6 py-md-4 px-md-11 mx-auto mt-10 mb-8"},"送出訂單",-1),ye={class:"d-flex"};function xe(a,t,ge,ke,e,p){const V=d("LoadingView"),L=d("UserCartEmptyData"),T=d("LoadingSpinner"),I=d("MealList"),u=d("VField"),_=d("ErrorMessage"),S=d("VForm"),f=d("RouterLink");return o(),l(O,null,[s("div",P,[n(V,{active:a.isLoading},null,8,["active"]),s("div",B,[q,H,s("div",{class:c(["step",{active:e.step===2||e.step===3}]),id:"step2"},z,2),G,s("div",{class:c(["step",{active:e.step===3}]),id:"step3"},K,2)])]),e.step===3?(o(),l("div",Q,[e.step===3?(o(),l("h2",W,"感謝您的訂餐")):r("",!0),e.step===3?(o(),l("h2",X,"此筆訂單已成立!")):r("",!0),e.step===3?(o(),l("h3",Y,"訂單編號: "+E(e.orderId),1)):r("",!0)])):r("",!0),e.step===2||e.step===3?(o(),l("h3",Z,"訂餐明細")):r("",!0),a.carts.length===0&&e.step===1?(o(),l("div",$,[n(L)])):(o(),l("div",ee,[s("div",se,[a.isAreaLoading?(o(),l("div",te,[n(T,{scale:.5})])):r("",!0),n(I,{class:c({invisible:a.isAreaLoading}),step:e.step,list:e.step===3?a.orderItem:a.carts,total:e.step===3?e.orderTotal:a.final_total},null,8,["class","step","list","total"])]),e.step===2||e.step===3?(o(),l("h3",oe,"付款方式")):r("",!0),e.step===2||e.step===3?(o(),h(S,{key:1,onSubmit:t[5]||(t[5]=m=>p.handleOrderSubmit())},{default:b(({errors:m})=>[s("div",re,[e.step===2||e.step===3?(o(),h(u,{key:0,name:"付款方式",id:"name",class:c(["bg-transparent p-2 form-control d-block rounded",{"is-invalid":m.付款方式}]),disabled:e.step===3,modelValue:e.obj.choose,"onUpdate:modelValue":t[0]||(t[0]=i=>e.obj.choose=i),rules:"required|in:['請選擇', '到店取餐付款', '信用卡']",as:"select"},{default:b(()=>[le,s("option",ae,"到店取餐付款",512),s("option",ne,"信用卡",512)]),_:2},1032,["disabled","modelValue","class"])):r("",!0),n(_,{name:"付款方式",class:"invalid-feedback"})]),e.step===2||e.step===3?(o(),l("h3",ie,"訂餐人資料")):r("",!0),s("div",de,[s("div",ce,[s("div",me,[pe,n(u,{type:"text",id:"name",name:"姓名",class:c(["form-control w-100",{"is-invalid":m.姓名}]),placeholder:"請輸入姓名",rules:"required",autofocus:"",modelValue:e.userData.data.user.name,"onUpdate:modelValue":t[1]||(t[1]=i=>e.userData.data.user.name=i),disabled:e.step===3},null,8,["class","modelValue","disabled"]),n(_,{name:"姓名",class:"invalid-feedback"})]),s("div",ue,[_e,n(u,{type:"text",id:"orderTel",name:"電話",class:c(["form-control",{"is-invalid":m.電話}]),placeholder:"請輸入電話",rules:"required|numeric|min:10|max:10",autofocus:"",modelValue:e.userData.data.user.tel,"onUpdate:modelValue":t[2]||(t[2]=i=>e.userData.data.user.tel=i),disabled:e.step===3},null,8,["class","modelValue","disabled"]),n(_,{name:"電話",class:"invalid-feedback"})]),s("div",he,[be,n(u,{type:"email",name:"email",id:"email",class:c(["form-control",{"is-invalid":m.email}]),placeholder:"abc@gmail.com",rules:"email|required",autofocus:"",modelValue:e.userData.data.user.email,"onUpdate:modelValue":t[3]||(t[3]=i=>e.userData.data.user.email=i),disabled:e.step===3},null,8,["class","modelValue","disabled"]),n(_,{name:"email",class:"invalid-feedback"})])]),e.step===2?(o(),l("div",fe,[s("a",{href:"javascript:;",class:"btn_reserve py-3 px-6 py-md-4 px-md-11 mx-auto mt-10 mb-8",onClick:t[4]||(t[4]=i=>p.nextStep(1))},"上一步"),ve])):r("",!0)])]),_:1})):r("",!0),e.step===1?(o(),l("a",{key:2,href:"javascript:;",class:"btn_reserve py-3 px-9 py-md-4 px-md-11 mx-auto mt-10 mb-8",onClick:t[6]||(t[6]=m=>p.nextStep(2))},"下一步")):r("",!0),s("div",ye,[e.step===3?(o(),h(f,{key:0,onClick:p.scrollTo,to:"/menuview/menulist?category=salad",class:"btn_reserve py-3 px-5 py-md-4 px-md-11 mx-auto mt-10 mb-8"},{default:b(()=>[x("繼續購物")]),_:1},8,["onClick"])):r("",!0),e.step===3?(o(),h(f,{key:1,to:"/userorders",class:"btn_reserve py-3 px-5 py-md-4 px-md-11 mx-auto mt-10 mb-8"},{default:b(()=>[x("查看我的所有訂單")]),_:1})):r("",!0)])]))],64)}const we=w(F,[["render",xe]]);export{we as default};
